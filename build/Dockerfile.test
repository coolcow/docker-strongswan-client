# This Dockerfile is for running smoke tests on the strongSwan client image.

# The application image to test is passed as a build argument.
# The default value is for local testing.
ARG APP_IMAGE=ghcr.io/coolcow/strongswan-client:latest
FROM ${APP_IMAGE}

# Run smoke tests directly inside the application image.
# If any command fails, the build will fail, indicating a problem.
RUN \
    test -x /usr/sbin/ipsec && \
    test -x /cmd.sh && \
    test -x /usr/local/bin/entrypoint.sh && \
    test -x /usr/local/bin/entrypoint_su-exec.sh && \
    test -x /usr/local/bin/create_user_group_home.sh && \
    test -f /etc/strongswan.d/charon-logging.conf && \
    echo "Checking strongSwan version..." && \
    ipsec --version